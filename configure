#!/bin/bash

# 100% only to comply to R package guidelines
# Trick from Dirk Eddelb√ºttel: https://stackoverflow.com/a/46480600
#!/usr/bin/env bash

echo "CONFIGURE...."

rm -v src/Makevars
rm -v src/mcupgma/clustering_util/Makefile

if [ "$(uname)" == "Darwin" ]; then
  cp -v src/mcupgma/clustering_util/Makefile.gcc src/mcupgma/clustering_util/Makefile
  cp -v src/Makevars.gcc src/Makevars
elif [ "$(expr substr $(uname -s) 1 5)" == "Linux" ]; then
  cp -v src/mcupgma/clustering_util/Makefile.gcc src/mcupgma/clustering_util/Makefile
  cp -v src/Makevars.gcc src/Makevars
elif [ "$(expr substr $(uname -s) 1 10)" == "MINGW32_NT" ]; then
  cp -v src/mcupgma/clustering_util/Makefile.gcc src/mcupgma/clustering_util/Makefile
  cp -v src/Makevars.gcc src/Makevars
elif [ "$(expr substr $(uname -s) 1 10)" == "MINGW64_NT" ]; then
  cp -v src/mcupgma/clustering_util/Makefile.gcc src/mcupgma/clustering_util/Makefile
  cp -v src/Makevars.gcc src/Makevars
else
  echo "Sorry, your platform is not supported for build."
  exit 1;
fi

#if [[ "${CI}" != "true" ]]; then
#  echo "** Adding unportable -mavx flag"
#  sed -i 's|\s*-mavx||' src/Makevars
#  sed -i 's|\(PKG_CXXFLAGS=.*\)|\1 -mavx|' src/Makevars
#fi
